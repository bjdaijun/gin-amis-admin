---
# 页面管理初始化(服务启动时会进行数据检查，如果存在则不再初始化)
- name: "首页"
  identify: "/dashboard"
  source: |
    {
        "$schema": "https://houtai.baidu.com/v2/schemas/page.json",
        "type": "page",
        "title": "使用教程",
        "body": {
            "type": "tabs",
            "tabs": [
                {
                    "title": "页面制作",
                    "tab": [
                        {
                            "type": "alert",
                            "level": "success",
                            "body": "基于amis的页面在线开发系统使用教程说明"
                        },
                        {
                            "type": "html",
                            "html": "<h4>1. 新增页面</h4>"
                        },
                        {
                            "type": "panel",
                            "body": "<p></p><p>点击<a>在线开发/页面制作</a>里面的<strong>新增</strong>按钮</a></p><p>填入<strong>页面名称</strong>,<strong>页面标识</strong>,<strong>页面源码</strong></p><p>其中<strong>页面源码</strong>相关内容请到<a href='https://baidu.github.io/amis/form/mode' target='_blank'>amis官网</a>查看对应的组件源码拷贝过来</p><p>点击确定按钮保存</p><p><code>注: 页面名称和页面标识必须要唯一,其中页面标识其实是跟菜单路由一一对应的</code></p><img src='/img/guide/page-add.jpg'/>"
                        },
                        {
                            "type": "divider"
                        },
                        {
                            "type": "html",
                            "html": "<h4>2. 发布到菜单</h4>"
                        },
                        {
                            "type": "panel",
                            "body": "<p>新创建的页面怎么才能在菜单里面显示用户可以查看呢？这里需要用到发布到菜单的功能</p><p>点击<a>在线开发/页面制作</a>里面的<strong>发布到菜单</strong>按钮</p><p>补充对应的表单内容,其中如果<strong>上级菜单</strong>不填则默认根菜单，如果有多级菜单，先这里创建后重新发布多一次然后选择上次发布的菜单,以下以创建二级菜单为例:</p><br/></br><p>先创建对应的顶级菜单</p><img src='/img/guide/push-menu-first.jpg'/><br/></br><p>再创建对应的子菜单</p><img src='/img/guide/push-menu-second.jpg'/><p>最终效果:</p><img src='/img/guide/push-menu-result.jpg'/>"
                        },
                        {
                            "type": "alert",
                            "level": "info",
                            "body": "恭喜你已经完成一个页面的创建流程了！剩下的工作就是提供你的数据接口并修改对应的页面json里面对应的api相关接口保存就可以实时预览页面了，其中如果修改错误还有对应的历史版本可以回滚，请开始你的后台制作吧！"
                        }
                    ]
                },
                {
                    "title": "接口数据格式",
                    "tab": [
                        {
                            "type": "html",
                            "html": "<h3>整体格式</h3>"
                        },
                        {
                            "type": "html",
                            "html": "<p>要求每个接口都返回 <code>status</code> 字段用来表示成功还是失败，如果失败了，通过 <code>msg</code> 字段来说明失败原因。当然如果成功 <code>msg</code> 也可以用来设置提示信息。</p>"
                        },
                        {
                            "title": "",
                            "type": "form",
                            "autoFocus": false,
                            "submitText": null,
                            "actions": [],
                            "controls": [
                                {
                                    "type": "json-editor",
                                    "value": "{\"status\":0,\"msg\":\"\",\"data\":{}}"
                                }
                            ]
                        },
                        {
                            "type": "html",
                            "html": "<p><code>status</code> 0 表示成功，非0 表示失败</p><p>如果接口不能按以上要求返回数据，可以使用<code>adaptor</code>调整格式后再返回给api，具体示例可以参考<a>在线开发/页面制作</a>的页面源码,</br>同样的提交的数据如果需要提交前做调整，可以使用<code>requestAdaptor</code>调整格式后再提交,具体示例可以参考<a>角色管理</a>的页面源码</p>"
                        },
                        {
                            "type": "divider"
                        },
                        {
                            "type": "html",
                            "html": "<h4>成功示例</h4>"
                        },
                        {
                            "title": "",
                            "type": "form",
                            "autoFocus": false,
                            "submitText": null,
                            "actions": [],
                            "controls": [
                                {
                                    "type": "json-editor",
                                    "value": "{\"status\":0,\"msg\":\"OK\",\"data\":{\"count\":8,\"rows\":[{\"id\":7,\"identify\":\"/tools/tpl_store\",\"name\":\"模板商城\",\"source\":\"示例源码\"},{\"id\":8,\"identify\":\"/tools/tpl_store\",\"name\":\"模板商城\",\"source\":\"示例源码\"}]}}"
                                }
                            ]
                        },
                        {
                            "type": "html",
                            "html": "<p><code>data.count</code> 表示当前记录总条数</p><p><code>data.rows</code>表示具体的列数据</p>"
                        },
                        {
                            "type": "divider"
                        },
                        {
                            "type": "html",
                            "html": "<h4>失败示例</h4>"
                        },
                        {
                            "title": "",
                            "type": "form",
                            "autoFocus": false,
                            "submitText": null,
                            "actions": [],
                            "controls": [
                                {
                                    "type": "json-editor",
                                    "value": "{\"status\":-1,\"msg\":\"操作失败\",\"data\":{}}"
                                }
                            ]
                        }
                    ]
                },
                {
                    "title": "权限控制",
                    "tab": [
                        {
                            "type": "html",
                            "html": "<h3>控制按钮的显示</h3>"
                        },
                        {
                            "type": "html",
                            "html": "<p>如果要根据权限控制相关按钮的显示隐藏，需要在相关页面组件中使用<code>visibleOn</code>字段来显示，当条件为true时会显示相应的组件，代码如下:"
                        },
                        {
                            "title": "",
                            "type": "form",
                            "autoFocus": false,
                            "submitText": null,
                            "actions": [],
                            "controls": [
                                {
                                    "type": "json-editor",
                                    "value": "{\"buttons\":[{\"actionType\":\"ajax\",\"api\":{\"adaptor\":\"{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok'; }return payload;}\",\"headers\":{\"Authorization\":\"${_authorization}\"},\"method\":\"post\",\"url\":\"${_page_schema_api|raw}/api/v1/page_manager/$id\"},\"icon\":\"fa fa-clone\",\"reload\":\"page-manage-table\",\"tooltip\":\"克隆当前页\",\"type\":\"button\",\"visibleOn\":\"acl.can('/tools/page_manager::clone')\"}]}"
                                }
                            ]
                        },
                        {
                            "type": "html",
                            "html": "其中/tools/page_manager::clone以::区服路由和动作标识，/tools/page_manager表示当前页面的路由，对应<code>菜单管理</code>的<b>访问路径</b>, clone对应<code>菜单管理</code>的<b>动作(按钮)中的动作编号</b><img src='/img/guide/permission-button-visible.jpg'/>"
                        },
                        {
                            "type": "divider"
                        },
                        {
                            "type": "html",
                            "html": "<h3>接口的访问权限</h3>"
                        },
                        {
                            "type": "html",
                            "html": "<p>请求的数据外部接口是否有相关的功能权限允许访问，这里需要在header里面带上Authorization传递给第三方接口，后续第三方接口可以调用平台的接口拉取对应的权限列表自行判断是否满足访问权限，代码如下:"
                        },
                        {
                            "title": "",
                            "type": "form",
                            "autoFocus": false,
                            "submitText": null,
                            "actions": [],
                            "controls": [
                                {
                                    "type": "json-editor",
                                    "value": "{\"buttons\":[{\"actionType\":\"ajax\",\"api\":{\"adaptor\":\"{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok'; }return payload;}\",\"headers\":{\"Authorization\":\"${_authorization}\"},\"method\":\"post\",\"url\":\"${_page_schema_api|raw}/api/v1/page_manager/$id\"},\"icon\":\"fa fa-clone\",\"reload\":\"page-manage-table\",\"tooltip\":\"克隆当前页\",\"type\":\"button\",\"visibleOn\":\"acl.can('/tools/page_manager::clone')\"}]}"
                                }
                            ]
                        },
                        {
                            "type": "html",
                            "html": "其中\\${_authorization}是系统登录后生成的jwt字符串全局变量，可以在页面中引用到，更多全局变量的说明可以查看<a>系统管理/系统配置中</a>的全局变量配置"
                        }
                    ]
                }
            ]
        }
    }
- name: "菜单管理"
  identify: "/system/menu"
  source: |
    {
      "$schema": "http://amis.baidu.com/v2/schemas/page.json#",
      "type": "page",
      "title": "菜单管理",
      "aside": [
        {
          "name": "menu-tree-preview",
          "title": "菜单树状图",
          "type": "form",
          "mode": "normal",
          "submitOnChange": true,
          "target": "menu-manage-table",
          "reload": "menu-manage-table?parentID=${parent_id}",
          "visibleOn": "acl.can('/system/menu::query')",
          "actions": [
          ],
          "controls": [
            {
              "name": "parent_id",
              "label": "",
              "clearable": true,
              "type": "tree",
              "showIcon": false,
              "value": {},
              "source": {
                "method": "get",
                "url": "${_page_schema_api|raw}/api/v1/menus.tree",
                "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};var list=payload.list;var newList=[];for(var i in list){var item=list[i];item.label=item.name;item.value=item.id;if(item.children!=undefined){for(var j in item.children){var childrenItem=item.children[j];item.children[j].label=childrenItem.name;item.children[j].value=childrenItem.id}}newList.push(item)};payload.data.options = newList;payload.status=0;payload.msg='ok'; }return payload;}",
                "headers": {
                   "Authorization": "${_authorization}"
                }
              }
            }
          ]
        }
      ],
      "body": {
        "name": "menu-manage-table",
        "type": "crud",
        "draggable": false,
        "pageField": "current",
        "perPageField": "pageSize",
        "syncLocation": false,
        "api": {
          "url": "${_page_schema_api|raw}/api/v1/menus",
          "method": "get",
          "headers": {
            "Authorization": "${_authorization}"
          },
          "data": {
            "&": "$$"
          },
          "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.data.rows=payload.list;payload.data.count=payload.pagination.total;payload.status=0;payload.msg='ok'; }return payload;}"
        },
        "keepItemSelectionOnPageChange": true,
        "filter": {
          "title": "条件搜索",
          "submitText": "",
          "visibleOn": "acl.can('/system/menu::query')",
          "controls": [
            {
              "type": "text",
              "name": "queryValue",
              "placeholder": "搜索菜单",
              "addOn": {
                "label": "搜索",
                "type": "submit"
              }
            }
          ]
        },
        "filterTogglable": true,
        "headerToolbar": [
          {
            "name": "menu-add",
            "type": "button",
            "actionType": "drawer",
            "label": "新增",
            "icon": "fa fa-plus pull-left",
            "primary": true,
            "visibleOn": "acl.can('/system/menu::add')",
            "drawer": {
              "title": "新增",
              "resizable": true,
              "position": "left",
              "size": "lg",
              "body": {
                "type": "form",
                "name": "menu-add-form",
                "api": {
                  "url": "${_page_schema_api|raw}/api/v1/menus",
                  "method": "post",
                  "headers": {
                    "Authorization": "${_authorization}"
                  },
                  "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok'; }return payload;}"
                },
                "mode": "horizontal",
                "controls": [
                  {
                    "name": "name",
                    "label": "菜单名称",
                    "sortable": true,
                    "type": "text",
                    "required": true
                  },
                  {
                    "type": "tree-select",
                    "clearable": true,
                    "searchable": true,
                    "name": "parent_id",
                    "label": "上级菜单",
                    "source": {
                      "method": "get",
                      "url": "${_page_schema_api|raw}/api/v1/menus.tree",
                      "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};var list=payload.list;var newList=[];for(var i in list){var item=list[i];item.label=item.name;item.value=item.id;if(item.children!=undefined){for(var j in item.children){var childrenItem=item.children[j];item.children[j].label=childrenItem.name;item.children[j].value=childrenItem.id}}newList.push(item)};payload.data.options = newList;payload.status=0;payload.msg='ok'; }return payload;}",
                      "headers": {
                         "Authorization": "${_authorization}"
                      }
                    }
                  },
                  {
                    "name": "router",
                    "label": "访问路径",
                    "sortable": true,
                    "type": "text",
                    "required": true
                  },
                  {
                    "name": "icon",
                    "label": "菜单图标",
                    "sortable": true,
                    "type": "text",
                    "placeholder": "fa fa-bars",
                    "remark": "fontawesome图标"
                  },
                  {
                    "type": "radios",
                    "name": "show_status",
                    "label": "是否显示",
                    "inline": true,
                    "value": 1,
                    "options": [
                      {
                        "label": "显示",
                        "value": 1
                      },
                      {
                        "label": "隐藏",
                        "value": 2
                      }
                    ]
                  },
                  {
                    "type": "radios",
                    "name": "status",
                    "label": "状态",
                    "inline": true,
                    "value": 1,
                    "options": [
                      {
                        "label": "启用",
                        "value": 1
                      },
                      {
                        "label": "禁用",
                        "value": 2
                      }
                    ]
                  },
                  {
                    "type": "number",
                    "name": "sequence",
                    "label": "排序值",
                    "placeholder": "",
                    "inline": true,
                    "value": 1000000,
                    "required": true
                  },
                  {
                    "name": "memo",
                    "label": "备注",
                    "sortable": true,
                    "type": "text"
                  },
                  {
                    "type": "combo",
                    "name": "actions",
                    "label": "动作(按钮)",
                    "multiLine": true,
                    "multiple": true,
                    "controls": [
                      {
                        "name": "code",
                        "type": "text",
                        "label": "动作编号",
                        "placeholder": "add"
                      },
                      {
                        "name": "name",
                        "type": "text",
                        "label": "动作名称",
                        "placeholder": "新增"
                      },
                      {
                        "type": "combo",
                        "name": "resources",
                        "label": "资源管理(服务端接口映射)",
                        "multiple": true,
                        "value": [
                          {}
                        ],
                        "controls": [
                          {
                            "name": "method",
                            "type": "select",
                            "label": "请求方式",
                            "options": [
                              {
                                "label": "GET",
                                "value": "GET"
                              },
                              {
                                "label": "POST",
                                "value": "POST"
                              },
                              {
                                "label": "PUT",
                                "value": "PUT"
                              },
                              {
                                "label": "DELETE",
                                "value": "DELETE"
                              },
                              {
                                "label": "PATCH",
                                "value": "PATCH"
                              },
                              {
                                "label": "HEAD",
                                "value": "HEAD"
                              },
                              {
                                "label": "OPTIONS",
                                "value": "OPTIONS"
                              }
                            ]
                          },
                          {
                            "name": "path",
                            "type": "text",
                            "label": "请求路径"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            }
          },
          {
            "type": "columns-toggler",
            "align": "right"
          },
          {
            "type": "pagination",
            "align": "right"
          },
          {
            "type": "filter-toggler",
            "align": "right"
          }
        ],
        "footerToolbar": [
          "statistics",
          "switch-per-page",
          "pagination"
        ],
        "columns": [
          {
            "name": "name",
            "label": "菜单名称",
            "sortable": true,
            "type": "text",
            "toggled": true
          },
          {
            "name": "sequence",
            "label": "排序值",
            "sortable": true,
            "type": "text",
            "toggled": true
          },
          {
            "name": "icon",
            "label": "菜单图标",
            "sortable": true,
            "type": "text",
            "toggled": true
          },
          {
            "name": "router",
            "label": "访问路由",
            "sortable": true,
            "type": "text",
            "toggled": true
          },
          {
            "name": "status",
            "label": "状态",
            "sortable": true,
            "type": "mapping",
            "toggled": true,
            "map": {
              "1": "<span class='label label-success'>启用</span>",
              "2": "<span class='label label-danger'>禁用</span>"
            }
          },
          {
            "name": "created_at",
            "label": "创建时间",
            "sortable": true,
            "type": "date",
            "format": "YYYY-MM-DD hh:mm:ss",
            "toggled": true
          },
          {
            "name": "memo",
            "label": "备注",
            "sortable": true,
            "type": "text",
            "toggled": true
          },
          {
            "type": "operation",
            "label": "操作",
            "width": 200,
            "visibleOn": "acl.can('/system/menu::edit', '/system/menu::del')",
            "buttons": [
              {
                "type": "button",
                "icon": "fa fa-pencil",
                "tooltip": "编辑",
                "actionType": "drawer",
                "visibleOn": "acl.can('/system/menu::edit')",
                "drawer": {
                  "position": "left",
                  "size": "lg",
                  "title": "编辑",
                  "resizable": true,
                  "body": {
                    "type": "form",
                    "name": "sample-edit-form",
                    "api": {
                      "url": "${_page_schema_api|raw}/api/v1/menus/$id",
                      "method": "put",
                      "headers": {
                        "Authorization": "${_authorization}"
                      },
                      "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok'; }return payload;}"
                    },
                    "controls": [
                      {
                        "name": "name",
                        "label": "菜单名称",
                        "sortable": true,
                        "type": "text",
                        "required": true
                      },
                      {
                        "type": "tree-select",
                        "name": "parent_id",
                        "clearable": true,
                        "searchable": true,
                        "label": "上级菜单",
                        "source": {
                          "method": "get",
                          "url": "${_page_schema_api|raw}/api/v1/menus.tree",
                          "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};var list=payload.list;var newList=[];for(var i in list){var item=list[i];item.label=item.name;item.value=item.id;if(item.children!=undefined){for(var j in item.children){var childrenItem=item.children[j];item.children[j].label=childrenItem.name;item.children[j].value=childrenItem.id}}newList.push(item)};payload.data.options = newList;payload.status=0;payload.msg='ok'; }return payload;}",
                          "headers": {
                             "Authorization": "${_authorization}"
                          }
                        }
                      },
                      {
                        "name": "router",
                        "label": "访问路径",
                        "sortable": true,
                        "type": "text",
                        "required": true
                      },
                      {
                        "name": "icon",
                        "label": "菜单图标",
                        "sortable": true,
                        "type": "text",
                        "placeholder": "fa fa-bars",
                        "remark": "fontawesome图标"
                      },
                      {
                        "type": "radios",
                        "name": "show_status",
                        "label": "是否显示",
                        "inline": true,
                        "value": 1,
                        "options": [
                          {
                            "label": "显示",
                            "value": 1
                          },
                          {
                            "label": "隐藏",
                            "value": 2
                          }
                        ]
                      },
                      {
                        "type": "radios",
                        "name": "status",
                        "label": "状态",
                        "inline": true,
                        "value": 1,
                        "options": [
                          {
                            "label": "启用",
                            "value": 1
                          },
                          {
                            "label": "禁用",
                            "value": 2
                          }
                        ]
                      },
                      {
                        "type": "number",
                        "name": "sequence",
                        "label": "排序值",
                        "placeholder": "",
                        "inline": true,
                        "value": 1000000,
                        "required": true
                      },
                      {
                        "name": "memo",
                        "label": "备注",
                        "sortable": true,
                        "type": "text"
                      },
                      {
                        "type": "combo",
                        "name": "actions",
                        "label": "动作(按钮)",
                        "multiLine": true,
                        "multiple": true,
                        "controls": [
                          {
                            "name": "code",
                            "type": "text",
                            "label": "动作编号",
                            "placeholder": "add"
                          },
                          {
                            "name": "name",
                            "type": "text",
                            "label": "动作名称",
                            "placeholder": "新增"
                          },
                          {
                            "type": "combo",
                            "name": "resources",
                            "label": "资源管理(服务端接口映射)",
                            "multiple": true,
                            "value": [
                              {}
                            ],
                            "controls": [
                              {
                                "name": "method",
                                "type": "select",
                                "label": "请求方式",
                                "options": [
                                  {
                                    "label": "GET",
                                    "value": "GET"
                                  },
                                  {
                                    "label": "POST",
                                    "value": "POST"
                                  },
                                  {
                                    "label": "PUT",
                                    "value": "PUT"
                                  },
                                  {
                                    "label": "DELETE",
                                    "value": "DELETE"
                                  },
                                  {
                                    "label": "PATCH",
                                    "value": "PATCH"
                                  },
                                  {
                                    "label": "HEAD",
                                    "value": "HEAD"
                                  },
                                  {
                                    "label": "OPTIONS",
                                    "value": "OPTIONS"
                                  }
                                ]
                              },
                              {
                                "name": "path",
                                "type": "text",
                                "label": "请求路径"
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                }
              },
              {
                "type": "button",
                "icon": "fa fa-times text-danger",
                "actionType": "ajax",
                "tooltip": "删除",
                "confirmText": "您确认要删除?",
                "reload": "menu-tree-preview",
                "visibleOn": "acl.can('/system/menu::del')",
                "api": {
                  "url": "${_page_schema_api|raw}/api/v1/menus/$id",
                  "method": "delete",
                  "headers": {
                    "Authorization": "${_authorization}"
                  },
                  "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok'; }return payload;}"
                }
              }
            ],
            "toggled": true
          }
        ]
      }
    }
- name: "角色管理"
  identify: "/system/role"
  source: |
    {
      "$schema": "http://amis.baidu.com/v2/schemas/page.json#",
      "type": "page",
      "title": "角色管理",
      "body": {
        "name": "user-manage-table",
        "type": "crud",
        "draggable": false,
        "pageField": "current",
        "perPageField": "pageSize",
        "syncLocation": false,
        "api": {
          "url": "${_page_schema_api|raw}/api/v1/roles",
          "method": "get",
          "headers": {
            "Authorization": "${_authorization}"
          },
          "data": {
            "&": "$$"
          },
          "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};var data=payload.list;for(var i in data){var newMenus=[];var roleMenus=data[i].role_menus;var menuId=\"\";for(var j in roleMenus){var roleItem=roleMenus[j];var menuValue=roleItem.menu_id+\"|\"+roleItem.action_id;menuId=roleItem.menu_id;newMenus.push(menuValue)}data[i].role_menus=newMenus};payload.data.rows=data;payload.data.count=payload.pagination.total;payload.status=0;payload.msg='ok';}return payload;}"
        },
        "keepItemSelectionOnPageChange": true,
        "filter": {
          "title": "条件搜索",
          "submitText": "",
          "visibleOn": "acl.can('/system/role::query')",
          "controls": [
            {
              "type": "text",
              "name": "queryValue",
              "placeholder": "搜索角色",
              "addOn": {
                "label": "搜索",
                "type": "submit"
              }
            }
          ]
        },
        "filterTogglable": true,
        "headerToolbar": [
          {
            "type": "button",
            "actionType": "drawer",
            "label": "新增",
            "icon": "fa fa-plus pull-left",
            "primary": true,
            "visibleOn": "acl.can('/system/role::add')",
            "drawer": {
              "title": "新增",
              "position": "left",
              "size": "lg",
              "resizable": true,
              "body": {
                "type": "form",
                "name": "sample-edit-form",
                "api": {
                  "url": "${_page_schema_api|raw}/api/v1/roles",
                  "method": "post",
                  "headers": {
                    "Authorization": "${_authorization}"
                  },
                  "requestAdaptor": "var data=api.data;var roleMenus=data.role_menus;var menus=[];for(var i in roleMenus){var item=roleMenus[i];var itemArr=item.split(\"|\");var length=itemArr.length;var menu={};if(length==1){menu.menu_id=itemArr[0]}else{menu.menu_id=itemArr[length-2];menu.action_id=itemArr[length-1]}menus.push(menu)};api.data.role_menus=menus;return api",
                  "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok';}return payload;}"
                },
                "controls": [
                  {
                    "name": "status",
                    "label": "备注",
                    "sortable": true,
                    "type": "hidden",
                    "value": 1
                  },
                  {
                    "name": "name",
                    "label": "角色名称",
                    "sortable": true,
                    "type": "text",
                    "required": true
                  },
                  {
                    "type": "number",
                    "name": "sequence",
                    "label": "排序值",
                    "placeholder": "",
                    "inline": true,
                    "value": 1000000,
                    "required": true
                  },
                  {
                    "name": "memo",
                    "label": "备注",
                    "sortable": true,
                    "type": "text"
                  },
                  {
                    "type": "tree",
                    "name": "role_menus",
                    "label": "选择菜单权限",
                    "multiple": true,
                    "clearable": true,
                    "withChildren": true,
                    "joinValues": false,
                    "extractValue": true,
                    "value": {},
                    "source": {
                      "method": "get",
                      "url": "${_page_schema_api|raw}/api/v1/menus.tree",
                      "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};var list=payload.list;var newList=[];for(var i in list){var item=list[i];item.label=item.name;item.value=item.id;if(item.children!=undefined){for(var j in item.children){var childrenItem=item.children[j];item.children[j].label=childrenItem.name;item.children[j].value=childrenItem.id;var actionChildren=[];if(childrenItem.actions!=undefined){for(var k in childrenItem.actions){var actionItem=childrenItem.actions[k];var actionObj={};actionObj.label=actionItem.name;actionObj.value=actionItem.menu_id+\"|\"+actionItem.id;actionChildren.push(actionObj)}}item.children[j].children=actionChildren}}newList.push(item)};payload.data.options = newList;payload.status=0;payload.msg='ok';}return payload;}",
                      "headers": {
                         "Authorization": "${_authorization}"
                      }
                    }
                  }
                ]
              }
            }
          },
          {
            "type": "columns-toggler",
            "align": "right"
          },
          {
            "type": "pagination",
            "align": "right"
          },
          {
            "type": "filter-toggler",
            "align": "right"
          }
        ],
        "footerToolbar": [
          "statistics",
          "switch-per-page",
          "pagination"
        ],
        "columns": [
          {
            "name": "name",
            "label": "角色名称",
            "sortable": true,
            "type": "text",
            "required": true
          },
          {
            "name": "sequence",
            "label": "排序值",
            "sortable": true,
            "type": "text",
            "required": true
          },
          {
            "name": "created_at",
            "label": "创建时间",
            "sortable": true,
            "type": "date",
            "format": "YYYY-MM-DD hh:mm:ss",
            "toggled": true
          },
          {
            "name": "memo",
            "label": "备注",
            "sortable": true,
            "type": "text",
            "required": true
          },
          {
            "type": "operation",
            "label": "操作",
            "width": 200,
            "visibleOn": "acl.can('/system/role::edit', '/system/role::del')",
            "buttons": [
              {
                "type": "button",
                "icon": "fa fa-pencil",
                "tooltip": "编辑",
                "actionType": "drawer",
                "visibleOn": "acl.can('/system/role::edit')",
                "drawer": {
                  "position": "left",
                  "size": "lg",
                  "title": "编辑",
                  "resizable": true,
                  "body": {
                    "type": "form",
                    "name": "sample-edit-form",
                    "api": {
                      "url": "${_page_schema_api|raw}/api/v1/roles/$id",
                      "method": "put",
                      "headers": {
                        "Authorization": "${_authorization}"
                      },
                      "requestAdaptor": "var data=api.data;var roleMenus=data.role_menus;var menus=[];for(var i in roleMenus){var item=roleMenus[i];var itemArr=item.split(\"|\");var length=itemArr.length;var menu={};if(length==1){menu.menu_id=itemArr[0]}else{menu.menu_id=itemArr[length-2];menu.action_id=itemArr[length-1]}menus.push(menu)}api.data.role_menus=menus;return api",
                      "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok';}return payload;}"
                    },
                    "controls": [
                      {
                        "name": "status",
                        "label": "备注",
                        "sortable": true,
                        "type": "hidden",
                        "value": 1
                      },
                      {
                        "name": "name",
                        "label": "角色名称",
                        "sortable": true,
                        "type": "text",
                        "required": true
                      },
                      {
                        "type": "number",
                        "name": "sequence",
                        "label": "排序值",
                        "placeholder": "",
                        "inline": true,
                        "value": 1000000,
                        "required": true
                      },
                      {
                        "name": "memo",
                        "label": "备注",
                        "sortable": true,
                        "type": "text"
                      },
                      {
                        "type": "tree",
                        "name": "role_menus",
                        "label": "选择菜单权限",
                        "multiple": true,
                        "clearable": true,
                        "withChildren": true,
                        "joinValues": false,
                        "extractValue": true,
                        "value": {},
                        "source": {
                          "method": "get",
                          "url": "${_page_schema_api|raw}/api/v1/menus.tree",
                          "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};var list=payload.list;var newList=[];for(var i in list){var item=list[i];item.label=item.name;item.value=item.id;if(item.children!=undefined){for(var j in item.children){var childrenItem=item.children[j];item.children[j].label=childrenItem.name;item.children[j].value=childrenItem.id;var actionChildren=[];if(childrenItem.actions!=undefined){for(var k in childrenItem.actions){var actionItem=childrenItem.actions[k];var actionObj={};actionObj.label=actionItem.name;actionObj.value=actionItem.menu_id+\"|\"+actionItem.id;actionChildren.push(actionObj)}}item.children[j].children=actionChildren}}newList.push(item)};payload.data.options = newList;payload.status=0;payload.msg='ok';}return payload;}",
                          "headers": {
                             "Authorization": "${_authorization}"
                          }
                        }
                      }
                    ]
                  }
                }
              },
              {
                "type": "button",
                "icon": "fa fa-times text-danger",
                "actionType": "ajax",
                "tooltip": "删除",
                "confirmText": "您确认要删除?",
                "visibleOn": "acl.can('/system/role::del')",
                "api": {
                  "url": "${_page_schema_api|raw}/api/v1/roles/$id",
                  "method": "delete",
                  "headers": {
                    "Authorization": "${_authorization}"
                  },
                  "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok';}return payload;}"
                }
              }
            ],
            "toggled": true
          }
        ]
      }
    }
- name: "用户管理"
  identify: "/system/user"
  source: |
    {
      "$schema": "http://amis.baidu.com/v2/schemas/page.json#",
      "type": "page",
      "title": "用户管理",
      "body": {
        "name": "user-manage-table",
        "type": "crud",
        "draggable": false,
        "pageField": "current",
        "perPageField": "pageSize",
        "syncLocation": false,
        "api": {
          "url": "${_page_schema_api|raw}/api/v1/users",
          "method": "get",
          "headers": {
            "Authorization": "${_authorization}"
          },
          "data": {
            "&": "$$"
          },
          "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};var data=payload.list;for(var i in data){var roleArr=[];var userRoles=[];var roles=data[i].roles;for(var j in roles){roleArr.push(roles[j].name);userRoles.push(roles[j].id)}data[i].roles=roleArr.join(\"|\");data[i].user_roles=userRoles};payload.data.rows=data;payload.data.count=payload.pagination.total;payload.status=0;payload.msg='ok';}return payload;}"
        },
        "keepItemSelectionOnPageChange": true,
        "filter": {
          "title": "条件搜索",
          "submitText": "",
          "visibleOn": "acl.can('/system/user::query')",
          "controls": [
            {
              "type": "text",
              "name": "queryValue",
              "placeholder": "搜索用户",
              "addOn": {
                "label": "搜索",
                "type": "submit"
              }
            }
          ]
        },
        "filterTogglable": true,
        "headerToolbar": [
          {
            "type": "button",
            "actionType": "drawer",
            "label": "新增",
            "icon": "fa fa-plus pull-left",
            "primary": true,
            "visibleOn": "acl.can('/system/user::add')",
            "drawer": {
              "title": "新增",
              "position": "left",
              "size": "lg",
              "resizable": true,
              "body": {
                "type": "form",
                "name": "sample-edit-form",
                "api": {
                  "url": "${_page_schema_api|raw}/api/v1/users",
                  "method": "post",
                  "headers": {
                    "Authorization": "${_authorization}"
                  },
                  "requestAdaptor": "var data=api.data;var userRoles=data.user_roles;var userRolesArr=userRoles.split(\",\");var newUserRoles=[];for(var i in userRolesArr){var userRolesItem=userRolesArr[i];var userRolesObj={};userRolesObj.role_id=userRolesItem;newUserRoles.push(userRolesObj)};api.data.user_roles=newUserRoles;api.data.password = md5(api.data.password);return api",
                  "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok';}return payload;}"
                },
                "controls": [
                  {
                    "name": "user_name",
                    "label": "用户名",
                    "sortable": true,
                    "type": "text",
                    "required": true
                  },
                  {
                    "name": "password",
                    "label": "密码",
                    "sortable": true,
                    "type": "password",
                    "required": true
                  },
                  {
                    "name": "real_name",
                    "label": "真实姓名",
                    "sortable": true,
                    "type": "text",
                    "required": true
                  },
                  {
                    "type": "text",
                    "name": "user_roles",
                    "label": "所属角色",
                    "multiple": true,
                    "source": {
                      "method": "get",
                      "url": "${_page_schema_api|raw}/api/v1/roles?q=select",
                      "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};var data=payload.list;var newOptions=[];for(var i in data){var roleItem=data[i];var option={};option.label=roleItem.name;option.value=roleItem.id;newOptions.push(option)};payload.data.options=newOptions;payload.status=0;payload.msg='ok';}return payload;}",
                      "headers": {
                        "Authorization": "${_authorization}"
                      }
                    },
                    "required": true
                  },
                  {
                    "type": "radios",
                    "name": "status",
                    "label": "用户状态",
                    "inline": true,
                    "value": 1,
                    "options": [
                      {
                        "label": "正常",
                        "value": 1
                      },
                      {
                        "label": "停用",
                        "value": 2
                      }
                    ]
                  },
                  {
                    "name": "email",
                    "label": "邮箱",
                    "sortable": true,
                    "type": "text",
                    "toggled": true
                  },
                  {
                    "name": "phone",
                    "label": "手机号",
                    "sortable": true,
                    "type": "text",
                    "toggled": true
                  }
                ]
              }
            }
          },
          {
            "type": "columns-toggler",
            "align": "right"
          },
          {
            "type": "pagination",
            "align": "right"
          },
          {
            "type": "filter-toggler",
            "align": "right"
          }
        ],
        "footerToolbar": [
          "statistics",
          "switch-per-page",
          "pagination"
        ],
        "columns": [
          {
            "name": "user_name",
            "label": "用户名",
            "sortable": true,
            "type": "text"
          },
          {
            "name": "real_name",
            "label": "真实姓名",
            "sortable": true,
            "type": "text"
          },
          {
            "name": "roles",
            "label": "角色名称",
            "sortable": true,
            "type": "text",
            "toggled": true
          },
          {
            "name": "status",
            "label": "用户状态",
            "sortable": true,
            "type": "mapping",
            "toggled": true,
            "map": {
              "1": "<span class='label label-success'>启用</span>",
              "2": "<span class='label label-danger'>禁用</span>"
            }
          },
          {
            "name": "email",
            "label": "邮箱",
            "sortable": true,
            "type": "text",
            "toggled": true
          },
          {
            "name": "phone",
            "label": "手机号",
            "sortable": true,
            "type": "text",
            "toggled": true
          },
          {
            "name": "created_at",
            "label": "创建时间",
            "sortable": true,
            "type": "date",
            "format": "YYYY-MM-DD hh:mm:ss",
            "toggled": true
          },
          {
            "type": "operation",
            "label": "操作",
            "width": 200,
            "visibleOn": "acl.can('/system/user::edit', 'system/user::del')",
            "buttons": [
              {
                "type": "button",
                "icon": "fa fa-pencil",
                "tooltip": "编辑",
                "actionType": "drawer",
                "visibleOn": "acl.can('/system/user::edit')",
                "drawer": {
                  "position": "left",
                  "size": "lg",
                  "title": "编辑",
                  "resizable": true,
                  "body": {
                    "type": "form",
                    "name": "sample-edit-form",
                    "api": {
                      "url": "${_page_schema_api|raw}/api/v1/users/$id",
                      "method": "put",
                      "headers": {
                        "Authorization": "${_authorization}"
                      },
                      "requestAdaptor": "var data=api.data;var userRoles=data.user_roles;var newUserRoles=[];if(typeof(userRoles)==\"object\"){for(var i in userRoles){var userRolesItem=userRoles[i];var userRolesObj={};userRolesObj.role_id=userRolesItem;newUserRoles.push(userRolesObj)}}else{var userRolesArr=userRoles.split(\",\");for(var i in userRolesArr){var userRolesItem=userRolesArr[i];var userRolesObj={};userRolesObj.role_id=userRolesItem;newUserRoles.push(userRolesObj)}};api.data.user_roles=newUserRoles;api.data.password = md5(api.data.password);return api",
                      "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok';}return payload;}"
                    },
                    "controls": [
                      {
                        "name": "user_name",
                        "label": "用户名",
                        "sortable": true,
                        "type": "text",
                        "required": true
                      },
                      {
                        "name": "password",
                        "label": "密码",
                        "sortable": true,
                        "type": "password",
                        "placeholder": "留空则不修改登录密码"
                      },
                      {
                        "name": "real_name",
                        "label": "真实姓名",
                        "sortable": true,
                        "type": "text",
                        "required": true
                      },
                      {
                        "type": "text",
                        "name": "user_roles",
                        "label": "所属角色",
                        "multiple": true,
                        "source": {
                          "method": "get",
                          "url": "${_page_schema_api|raw}/api/v1/roles?q=select",
                          "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};var data=payload.list;var newOptions=[];for(var i in data){var roleItem=data[i];var option={};option.label=roleItem.name;option.value=roleItem.id;newOptions.push(option)};payload.data.options=newOptions;payload.status=0;payload.msg='ok';}return payload;}",
                          "headers": {
                            "Authorization": "${_authorization}"
                          }
                        },
                        "required": true
                      },
                      {
                        "type": "radios",
                        "name": "status",
                        "label": "用户状态",
                        "inline": true,
                        "value": 1,
                        "options": [
                          {
                            "label": "正常",
                            "value": 1
                          },
                          {
                            "label": "停用",
                            "value": 2
                          }
                        ]
                      },
                      {
                        "name": "email",
                        "label": "邮箱",
                        "sortable": true,
                        "type": "text",
                        "toggled": true
                      },
                      {
                        "name": "phone",
                        "label": "手机号",
                        "sortable": true,
                        "type": "text",
                        "toggled": true
                      }
                    ]
                  }
                }
              },
              {
                "type": "button",
                "icon": "fa fa-times text-danger",
                "actionType": "ajax",
                "tooltip": "删除",
                "confirmText": "您确认要删除?",
                "visibleOn": "acl.can('/system/user::delete')",
                "api": {
                  "url": "${_page_schema_api|raw}/api/v1/users/$id",
                  "method": "delete",
                  "headers": {
                    "Authorization": "${_authorization}"
                  },
                  "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok';}return payload;}"
                }
              }
            ],
            "toggled": true
          }
        ]
      }
    }
- name: "系统配置"
  identify: "/system/setting"
  source: |
    {
        "$schema": "https://houtai.baidu.com/v2/schemas/page.json#",
        "type": "page",
        "title": "系统配置",
        "body": [
            {
                "type": "form",
                "title": false,
                "api": {
                    "url": "${_page_schema_api|raw}/api/v1/setting",
                    "method": "post",
                    "headers": {
                        "Authorization": "${_authorization}"
                    },
                    "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok';}return payload;}"
                },
                "initApi": {
                    "url": "${_page_schema_api|raw}/api/v1/setting",
                    "method": "get",
                    "headers": {
                        "Authorization": "${_authorization}"
                    }
                },
                "actions": [
                    {
                        "type": "submit",
                        "label": "提交",
                        "primary": true
                    }
                ],
                "collapsable": true,
                "controls": [
                    {
                        "type": "fieldSet",
                        "title": "基本信息",
                        "collapsable": false,
                        "controls": [
                            {
                                "type": "group",
                                "controls": [
                                    {
                                        "type": "text",
                                        "name": "platform_name",
                                        "label": "平台名称",
                                        "size": "lg"
                                    },
                                    {
                                        "type": "text",
                                        "name": "platform_logo",
                                        "label": "平台logo",
                                        "size": "lg",
                                        "placeholder": "fa fa-fort-awesome",
                                        "remark": "fontawesome图标"
                                    },
                                    {
                                        "type": "text",
                                        "name": "dashboard_route",
                                        "label": "首页路由",
                                        "size": "lg",
                                        "placeholder": "/dashboard",
                                        "remark": "配置登录成功后进入的首页路由，默认为/dashboard"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "type": "fieldSet",
                        "title": "全局环境变量",
                        "collapsable": true,
                        "controls": [
                            {
                                "type": "alert",
                                "level": "warning",
                                "body": "系统默认注册的全局变量: </br><p><b>权限资格: </b>\\${_authorization}</p><p><b>当前路由:</b>\\${_page_name}</p><p><b>当前应用标识:</b>\\${_app_id}</p><p><b>系统接口地址:</b>\\${_page_schema_api}  (对应web/js/config.js的pageSchemaApi配置，可自行修改)</p>"
                            },
                            {
                                "type": "html",
                                "html": "以下变量的值可以在页面源码的schema用<code>\\${_global_env.你的key名称}</code>取到对应的值,如${_global_env.myKeyName}"
                            },
                            {
                                "type": "combo",
                                "name": "global_env",
                                "label": false,
                                "multiple": true,
                                "value": [
                                    {}
                                ],
                                "controls": [
                                    {
                                        "name": "key",
                                        "type": "text",
                                        "placeholder": "key"
                                    },
                                    {
                                        "name": "value",
                                        "type": "text",
                                        "placeholder": "value"
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        ]
    }
- name: "页面制作"
  identify: "/tools/page_manager"
  source: |
    {
        "$schema": "http://amis.baidu.com/v2/schemas/page.json#",
        "type": "page",
        "title": "页面制作",
        "body": {
            "name": "page-manage-table",
            "type": "crud",
            "draggable": false,
            "pageField": "current",
            "perPageField": "pageSize",
            "syncLocation": false,
            "api": {
              "url": "${_page_schema_api|raw}/api/v1/page_manager",
              "method": "get",
              "headers": {
                "Authorization": "${_authorization}"
              },
              "data": {
                "&": "$$"
              }
            },
            "keepItemSelectionOnPageChange": true,
            "filter": {
                "title": "条件搜索",
                "submitText": "",
                "visibleOn": "acl.can('/tools/page_manager::query')",
                "controls": [
                    {
                        "type": "text",
                        "name": "queryValue",
                        "placeholder": "搜索页面名称",
                        "addOn": {
                            "label": "搜索",
                            "type": "submit"
                        }
                    }
                ]
            },
            "filterTogglable": true,
            "headerToolbar": [
                {
                    "type": "button",
                    "actionType": "drawer",
                    "label": "新增",
                    "icon": "fa fa-plus pull-left",
                    "primary": true,
                    "visibleOn": "acl.can('/tools/page_manager::add')",
                    "drawer": {
                        "title": "新增",
                        "position": "left",
                        "size": "lg",
                        "resizable": true,
                        "body": {
                            "type": "form",
                            "name": "sample-edit-form",
                            "api": {
                                "url": "${_page_schema_api|raw}/api/v1/page_manager",
                                "method": "post",
                                "headers": {
                                  "Authorization": "${_authorization}"
                                },
                                "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok';}return payload;}"
                            },
                            "controls": [
                                {
                                    "type": "text",
                                    "name": "name",
                                    "label": "页面名称",
                                    "required": true
                                },
                                {
                                    "type": "text",
                                    "name": "identify",
                                    "label": "页面标识",
                                    "description": "对应菜单的路由，必须唯一",
                                    "required": true,
                                    "placeholder": "/myapp/hello"
                                },
                                {
                                    "type": "editor",
                                    "name": "source",
                                    "label": "页面源码",
                                    "language": "json",
                                    "className": "h-full",
                                    "size": "xxl",
                                    "required": true
                                }
                            ]
                        }
                    }
                },
                {
                    "type": "link",
                    "href": "https://baidu.github.io/amis/crud/table",
                    "body": "更多amis官方例子",
                    "htmlTarget": "_blank",
                    "className": "v-middle"
                },
                {
                    "type": "columns-toggler",
                    "align": "right"
                },
                {
                    "type": "pagination",
                    "align": "right"
                },
                {
                  "type": "filter-toggler",
                  "align": "right"
                }
            ],
            "footerToolbar": [
                "statistics",
                "switch-per-page",
                "pagination"
            ],
            "columns": [
                {
                    "name": "id",
                    "label": "ID",
                    "width": 20,
                    "sortable": true,
                    "type": "text",
                    "toggled": true
                },
                {
                    "name": "name",
                    "label": "页面名称",
                    "sortable": true,
                    "type": "text",
                    "toggled": true
                },
                {
                    "type": "text",
                    "name": "identify",
                    "label": "页面标识",
                    "toggled": true
                },
                {
                    "name": "creator",
                    "label": "创建人",
                    "sortable": true,
                    "type": "text",
                    "toggled": true
                },
               {
                   "name": "create_time",
                   "label": "创建时间",
                   "sortable": true,
                   "type": "date",
                   "format": "YYYY-MM-DD hh:mm:ss",
                   "toggled": true
                },
                {
                    "type": "operation",
                    "label": "操作",
                    "width": 200,
                    "visibleOn": "acl.can('/tools/page_manager::clone', '/tools/page_manager::preview', '/tools/page_manager::edit', '/tools/page_manager::history-preview', '/tools/page_manager::preview', '/tools/page_manager::push-to-menu', '/tools/page_manager::del')",
                    "buttons": [
                        {
                            "type": "button",
                            "icon": "fa fa-clone",
                            "actionType": "ajax",
                            "tooltip": "克隆当前页",
                            "visibleOn": "acl.can('/tools/page_manager::clone')",
                            "api": {
                               "url": "${_page_schema_api|raw}/api/v1/page_manager/$id",
                               "method": "post",
                               "headers": {
                                 "Authorization": "${_authorization}"
                               },
                               "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok'; }return payload;}"
                            },
                            "reload": "page-manage-table"
                        },
                        {
                            "type": "button",
                            "icon": "fa fa-eye",
                            "actionType": "ajax",
                            "tooltip": "版本预览",
                            "visibleOn": "acl.can('/tools/page_manager::preview')",
                            "actionType": "dialog",
                            "dialog": {
                                "disabled": true,
                                "size": "full",
                                "title": "版本预览",
                                "body": {
                                   "type": "iframe",
                                   "src": "/page/preview.html?id=$id"
                                }
                            }
                        },
                        {
                            "type": "button",
                            "icon": "fa fa-pencil",
                            "tooltip": "编辑",
                            "actionType": "drawer",
                            "visibleOn": "acl.can('/tools/page_manager::edit')",
                            "drawer": {
                                "position": "left",
                                "size": "lg",
                                "title": "编辑",
                                "resizable": true,
                                "body": {
                                    "type": "form",
                                    "name": "sample-edit-form",
                                    "api": {
                                       "url": "${_page_schema_api|raw}/api/v1/page_manager/$id",
                                       "method": "put",
                                       "headers": {
                                         "Authorization": "${_authorization}"
                                       },
                                       "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok'; }return payload;}"
                                    },
                                    "controls": [
                                        {
                                            "type": "text",
                                            "name": "name",
                                            "label": "页面名称",
                                            "required": true
                                        },
                                        {
                                            "type": "text",
                                            "name": "identify",
                                            "label": "页面标识",
                                            "description": "对应菜单的路由，必须唯一",
                                            "required": true
                                        },
                                        {
                                            "type": "editor",
                                            "name": "source",
                                            "label": "页面源码",
                                            "language": "json",
                                            "className": "h-full",
                                            "size": "xxl",
                                            "required": true
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "type": "button",
                            "tooltip": "历史版本",
                            "icon": "fa fa-history",
                            "actionType": "dialog",
                            "visibleOn": "acl.can('/tools/page_manager::history-preview')",
                            "dialog": {
                                "title": "历史版本",
                                "size": "md",
                                "name": "page-history",
                                "body": {
                                    "type": "crud",
                                    "draggable": false,
                                    "pageField": "current",
                                    "perPageField": "pageSize",
                                    "syncLocation": false,
                                    "api": {
                                       "url": "${_page_schema_api|raw}/api/v1/page_manager/$id/history",
                                       "method": "get",
                                       "headers": {
                                         "Authorization": "${_authorization}"
                                       },
                                       "data": {
                                         "&": "$$"
                                       }
                                    },
                                    "keepItemSelectionOnPageChange": true,
                                    "filterTogglable": true,
                                    "headerToolbar": [
                                        {
                                            "type": "columns-toggler",
                                            "align": "right"
                                        },
                                        {
                                            "type": "pagination",
                                            "align": "right"
                                        }
                                    ],
                                    "footerToolbar": [
                                        "statistics",
                                        "switch-per-page",
                                        "pagination"
                                    ],
                                    "columns": [
                                        {
                                            "name": "id",
                                            "label": "ID",
                                            "width": 20,
                                            "sortable": true,
                                            "type": "text",
                                            "toggled": true
                                        },
                                        {
                                            "name": "name",
                                            "label": "页面名称",
                                            "sortable": true,
                                            "type": "text",
                                            "toggled": true
                                        },
                                        {
                                            "name": "create_time",
                                            "label": "版本时间",
                                            "sortable": true,
                                            "type": "date",
                                            "format": "YYYY-MM-DD hh:mm:ss",
                                            "toggled": true
                                        },
                                        {
                                                "name": "history_create_time",
                                                "label": "创建时间",
                                                "sortable": true,
                                                "type": "date",
                                                "format": "YYYY-MM-DD hh:mm:ss",
                                                "toggled": true
                                        },
                                        {
                                            "type": "operation",
                                            "label": "操作",
                                            "width": 100,
                                            "buttons": [
                                                {
                                                    "type": "button",
                                                    "icon": "fa fa-eye",
                                                    "actionType": "ajax",
                                                    "tooltip": "版本预览",
                                                    "actionType": "dialog",
                                                    "dialog": {
                                                        "disabled": true,
                                                        "size": "full",
                                                        "title": "版本预览",
                                                        "body": {
                                                           "type": "iframe",
                                                           "src": "/page/preview.html?type=history&id=$id"
                                                        }
                                                    }
                                                },
                                                {
                                                    "type": "button",
                                                    "icon": "fa fa-undo",
                                                    "actionType": "ajax",
                                                    "tooltip": "回滚到此版本",
                                                    "confirmText": "您确认要回滚到此版本吗?",
                                                    "api": {
                                                       "url": "${_page_schema_api|raw}/api/v1/page_manager/$id/source",
                                                       "method": "patch",
                                                       "headers": {
                                                         "Authorization": "${_authorization}"
                                                       }
                                                    },
                                                    "redirect": "/#/tools/page_manager"
                                                }
                                            ],
                                            "toggled": true
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "type": "button",
                            "icon": "fa fa-cloud-upload",
                            "tooltip": "发布到菜单",
                            "actionType": "drawer",
                            "visibleOn": "acl.can('/tools/page_manager::push-to-menu')",
                            "drawer": {
                                "title": "发布到菜单",
                                "resizable": true,
                                "position": "left",
                                "size": "lg",
                                "data": {
                                  "&": "$$",
                                  "router":"${identify|raw}",
                                  "_page_schema_api":"${_page_schema_api|raw}",
                                  "_authorization":"${_authorization}"
                                },
                                "body": {
                                    "type": "form",
                                    "name": "menu-add-form",
                                    "api": {
                                        "url": "${_page_schema_api|raw}/api/v1/menus",
                                        "method": "post",
                                        "headers": {
                                            "Authorization": "${_authorization}"
                                        },
                                        "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok'; }return payload;}"
                                    },
                                    "mode": "horizontal",
                                    "controls": [
                                        {
                                            "name": "name",
                                            "label": "菜单名称",
                                            "sortable": true,
                                            "type": "text",
                                            "required": true
                                        },
                                        {
                                            "type": "tree-select",
                                            "clearable": true,
                                            "searchable": true,
                                            "name": "parent_id",
                                            "label": "上级菜单",
                                            "source": {
                                                "method": "get",
                                                "url": "${_page_schema_api|raw}/api/v1/menus.tree",
                                                "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};var list=payload.list;var newList=[];for(var i in list){var item=list[i];item.label=item.name;item.value=item.id;if(item.children!=undefined){for(var j in item.children){var childrenItem=item.children[j];item.children[j].label=childrenItem.name;item.children[j].value=childrenItem.id}}newList.push(item)};payload.data.options = newList;payload.status=0;payload.msg='ok'; }return payload;}",
                                                "headers": {
                                                   "Authorization": "${_authorization}"
                                                }
                                            }
                                        },
                                        {
                                            "name": "router",
                                            "label": "访问路径",
                                            "sortable": true,
                                            "type": "text",
                                            "required": true
                                        },
                                        {
                                            "name": "icon",
                                            "label": "菜单图标",
                                            "sortable": true,
                                            "type": "text"
                                        },
                                        {
                                            "type": "radios",
                                            "name": "show_status",
                                            "label": "是否显示",
                                            "inline": true,
                                            "value": 1,
                                            "options": [
                                                {
                                                    "label": "显示",
                                                    "value": 1
                                                },
                                                {
                                                    "label": "隐藏",
                                                    "value": 2
                                                }
                                            ]
                                        },
                                        {
                                            "type": "radios",
                                            "name": "status",
                                            "label": "状态",
                                            "inline": true,
                                            "value": 1,
                                            "options": [
                                                {
                                                    "label": "启用",
                                                    "value": 1
                                                },
                                                {
                                                    "label": "禁用",
                                                    "value": 2
                                                }
                                            ]
                                        },
                                        {
                                            "type": "number",
                                            "name": "sequence",
                                            "label": "排序值",
                                            "placeholder": "",
                                            "inline": true,
                                            "value": 1000000,
                                            "required": true
                                        },
                                        {
                                            "name": "memo",
                                            "label": "备注",
                                            "sortable": true,
                                            "type": "text"
                                        },
                                        {
                                            "type": "combo",
                                            "name": "actions",
                                            "label": "动作(按钮)",
                                            "multiLine": true,
                                            "multiple": true,
                                            "controls": [
                                                {
                                                    "name": "code",
                                                    "type": "text",
                                                    "label": "动作编号",
                                                    "placeholder": "add"
                                                },
                                                {
                                                    "name": "name",
                                                    "type": "text",
                                                    "label": "动作名称",
                                                    "placeholder": "新增"
                                                },
                                                {
                                                    "type": "combo",
                                                    "name": "resources",
                                                    "label": "资源管理(服务端接口映射)",
                                                    "multiple": true,
                                                    "value": [
                                                        {}
                                                    ],
                                                    "controls": [
                                                        {
                                                            "name": "method",
                                                            "type": "select",
                                                            "label": "请求方式",
                                                            "options": [
                                                                {
                                                                    "label": "GET",
                                                                    "value": "GET"
                                                                },
                                                                {
                                                                    "label": "POST",
                                                                    "value": "POST"
                                                                },
                                                                {
                                                                    "label": "PUT",
                                                                    "value": "PUT"
                                                                },
                                                                {
                                                                    "label": "DELETE",
                                                                    "value": "DELETE"
                                                                },
                                                                {
                                                                    "label": "PATCH",
                                                                    "value": "PATCH"
                                                                },
                                                                {
                                                                    "label": "HEAD",
                                                                    "value": "HEAD"
                                                                },
                                                                {
                                                                    "label": "OPTIONS",
                                                                    "value": "OPTIONS"
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            "name": "path",
                                                            "type": "text",
                                                            "label": "请求路径"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "type": "button",
                            "icon": "fa fa-times text-danger",
                            "actionType": "ajax",
                            "tooltip": "删除",
                            "confirmText": "您确认要删除?",
                            "visibleOn": "acl.can('/tools/page_manager::del')",
                            "api": {
                               "url": "${_page_schema_api|raw}/api/v1/page_manager/$id",
                               "method": "delete",
                               "headers": {
                                 "Authorization": "${_authorization}"
                               },
                               "adaptor": "{if (payload.error != undefined){payload.data = {};payload.status=payload.error.code;payload.msg=payload.error.message;} else { payload.data = {};payload.status=0;payload.msg='ok'; }return payload;}"
                            }
                        }
                    ],
                    "toggled": true
                }
            ]
        }
    }


- name: "示例页面"
  identify: "/pages/example"
  source: |
    {
        "$schema": "https://houtai.baidu.com/v2/schemas/page.json#",
        "title": "表单各种展示模式汇总",
        "remark": "展示各种模式的 Form",
        "type": "page",
        "body": [
            {
                "type": "alert",
                "level": "success",
                "body": "温馨提示: 当前页面的源码修改可以在<a>在线开发/页面制作</a>里面找到！"
            },
            {
                "type": "grid",
                "columns": [
                    {
                        "type": "form",
                        "api": "https://houtai.baidu.com/api/mock2/form/saveForm?waitSeconds=2",
                        "title": "常规模式",
                        "mode": "normal",
                        "controls": [
                            {
                                "type": "email",
                                "name": "email",
                                "required": true,
                                "placeholder": "请输入邮箱",
                                "label": "邮箱",
                                "size": "full"
                            },
                            {
                                "type": "password",
                                "name": "password",
                                "label": "密码",
                                "required": true,
                                "placeholder": "请输入密码",
                                "size": "full"
                            },
                            {
                                "type": "checkbox",
                                "name": "rememberMe",
                                "label": "记住登录"
                            },
                            {
                                "type": "submit",
                                "btnClassName": "btn-default",
                                "label": "登录"
                            }
                        ]
                    },
                    {
                        "type": "form",
                        "api": "https://houtai.baidu.com/api/mock2/form/saveForm?waitSeconds=2",
                        "title": "常规模式 input md 尺寸",
                        "mode": "normal",
                        "controls": [
                            {
                                "type": "email",
                                "name": "email",
                                "required": true,
                                "placeholder": "请输入邮箱",
                                "label": "邮箱",
                                "size": "md",
                                "remark": "xxxx",
                                "hint": "bla bla bla"
                            },
                            {
                                "type": "password",
                                "name": "password",
                                "label": "密码",
                                "required": true,
                                "placeholder": "请输入密码",
                                "size": "md"
                            },
                            {
                                "type": "checkbox",
                                "name": "rememberMe",
                                "label": "记住登录"
                            },
                            {
                                "type": "submit",
                                "btnClassName": "btn-default",
                                "label": "登录"
                            }
                        ]
                    }
                ]
            },
            {
                "type": "grid",
                "columns": [
                    {
                        "type": "form",
                        "api": "https://houtai.baidu.com/api/mock2/form/saveForm?waitSeconds=2",
                        "title": "水平模式，左右摆放 左右比率分配 ",
                        "mode": "horizontal",
                        "autoFocus": false,
                        "horizontal": {
                            "left": "col-sm-2",
                            "right": "col-sm-10",
                            "offset": "col-sm-offset-2"
                        },
                        "controls": [
                            {
                                "type": "email",
                                "name": "email",
                                "placeholder": "请输入邮箱地址",
                                "label": "邮箱",
                                "required": true,
                                "desc": "表单描述文字"
                            },
                            {
                                "type": "password",
                                "name": "password",
                                "label": "密码",
                                "placeholder": "输入密码"
                            },
                            {
                                "type": "checkbox",
                                "name": "rememberMe",
                                "label": "记住登录"
                            }
                        ]
                    },
                    {
                        "type": "form",
                        "api": "https://houtai.baidu.com/api/mock2/form/saveForm?waitSeconds=2",
                        "title": "水平模式，左右摆放 左侧固定宽度 input md 尺寸",
                        "mode": "horizontal",
                        "autoFocus": false,
                        "horizontal": {
                            "leftFixed": "xs"
                        },
                        "controls": [
                            {
                                "type": "email",
                                "name": "email",
                                "placeholder": "请输入邮箱地址",
                                "label": "邮箱",
                                "required": true,
                                "desc": "表单描述文字",
                                "size": "md",
                                "remark": "xxxx",
                                "hint": "bla bla bla"
                            },
                            {
                                "type": "password",
                                "name": "password",
                                "label": "密码",
                                "placeholder": "输入密码",
                                "size": "md"
                            },
                            {
                                "type": "checkbox",
                                "name": "rememberMe",
                                "label": "记住登录"
                            }
                        ]
                    }
                ]
            },
            {
                "type": "form",
                "api": "https://houtai.baidu.com/api/mock2/form/saveForm?waitSeconds=2",
                "title": "内联模式",
                "mode": "inline",
                "autoFocus": false,
                "controls": [
                    {
                        "type": "email",
                        "name": "email",
                        "placeholder": "Enter Email",
                        "label": "邮箱",
                        "size": "auto"
                    },
                    {
                        "type": "password",
                        "name": "password",
                        "placeholder": "密码",
                        "size": "auto",
                        "remark": "Bla bla bla"
                    },
                    {
                        "type": "checkbox",
                        "name": "rememberMe",
                        "label": "记住登录",
                        "size": "auto"
                    },
                    {
                        "type": "submit",
                        "label": "登录"
                    },
                    {
                        "type": "button",
                        "label": "导出",
                        "url": "http://www.baidu.com/",
                        "level": "success"
                    }
                ]
            },
            {
                "type": "form",
                "api": "https://houtai.baidu.com/api/mock2/form/saveForm?waitSeconds=2",
                "title": "常规模式下用数组包起来还能控制一行显示多个",
                "mode": "normal",
                "autoFocus": false,
                "controls": [
                    {
                        "type": "text",
                        "name": "name",
                        "placeholder": "请输入...",
                        "label": "名字",
                        "size": "full"
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "group",
                        "controls": [
                            {
                                "type": "email",
                                "name": "email",
                                "placeholder": "输入邮箱",
                                "label": "邮箱",
                                "size": "full"
                            },
                            {
                                "type": "password",
                                "name": "password",
                                "label": "密码",
                                "placeholder": "请输入密码",
                                "size": "full"
                            }
                        ]
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "group",
                        "controls": [
                            {
                                "type": "email",
                                "name": "email2",
                                "mode": "inline",
                                "placeholder": "请输入邮箱地址",
                                "label": "邮箱",
                                "size": "full"
                            },
                            {
                                "type": "password",
                                "name": "password2",
                                "label": "密码",
                                "mode": "inline",
                                "placeholder": "请输入密码",
                                "size": "full"
                            }
                        ]
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "group",
                        "controls": [
                            {
                                "type": "email",
                                "name": "email3",
                                "mode": "inline",
                                "placeholder": "请输入邮箱地址",
                                "label": "邮箱",
                                "size": "full"
                            },
                            {
                                "type": "password",
                                "name": "password3",
                                "label": "密码",
                                "placeholder": "请输入密码",
                                "size": "full"
                            }
                        ]
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "group",
                        "controls": [
                            {
                                "type": "email",
                                "name": "email4",
                                "placeholder": "请输入邮箱地址",
                                "label": "邮箱",
                                "size": "full"
                            },
                            {
                                "type": "password",
                                "name": "password4",
                                "label": "密码",
                                "placeholder": "请输入密码",
                                "mode": "inline",
                                "size": "full"
                            }
                        ]
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "checkbox",
                        "name": "rememberMe",
                        "label": "记住我"
                    },
                    {
                        "type": "submit",
                        "btnClassName": "btn-default",
                        "label": "提交"
                    }
                ]
            },
            {
                "type": "form",
                "api": "https://houtai.baidu.com/api/mock2/form/saveForm?waitSeconds=2",
                "title": "水平模式用数组包起来也能控制一行显示多个",
                "mode": "horizontal",
                "autoFocus": false,
                "controls": [
                    {
                        "type": "email",
                        "name": "email",
                        "placeholder": "请输入邮箱地址",
                        "label": "邮箱",
                        "size": "full"
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "group",
                        "controls": [
                            {
                                "type": "email",
                                "name": "email2",
                                "placeholder": "请输入邮箱地址",
                                "label": "邮箱",
                                "size": "full"
                            },
                            {
                                "type": "password",
                                "name": "password2",
                                "label": "密码",
                                "placeholder": "请输入密码",
                                "size": "full"
                            }
                        ]
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "group",
                        "controls": [
                            {
                                "type": "email",
                                "name": "email3",
                                "placeholder": "请输入邮箱地址",
                                "label": "邮箱",
                                "size": "full"
                            },
                            {
                                "type": "password",
                                "name": "password3",
                                "label": "密码",
                                "placeholder": "请输入密码",
                                "size": "full"
                            },
                            {
                                "type": "password",
                                "name": "password3",
                                "label": "密码",
                                "placeholder": "请输入密码",
                                "size": "full"
                            }
                        ]
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "group",
                        "controls": [
                            {
                                "type": "email",
                                "name": "email4",
                                "placeholder": "请输入邮箱地址",
                                "label": "邮箱",
                                "size": "full",
                                "columnClassName": "col-sm-6",
                                "horizontal": {
                                    "left": "col-sm-4",
                                    "right": "col-sm-8"
                                }
                            },
                            {
                                "type": "password",
                                "name": "password4",
                                "label": "密码",
                                "placeholder": "请输入密码",
                                "mode": "inline",
                                "size": "full"
                            }
                        ]
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "group",
                        "label": "邮箱",
                        "gap": "xs",
                        "controls": [
                            {
                                "label": false,
                                "type": "email",
                                "name": "email5",
                                "placeholder": "请输入邮箱地址",
                                "size": "full"
                            },
                            {
                                "type": "password",
                                "name": "password5",
                                "label": "密码",
                                "placeholder": "请输入密码",
                                "mode": "inline",
                                "size": "full"
                            }
                        ]
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "group",
                        "label": "邮箱",
                        "description": "bla bla",
                        "gap": "xs",
                        "controls": [
                            {
                                "type": "email",
                                "name": "email6",
                                "placeholder": "请输入邮箱地址",
                                "mode": "inline"
                            },
                            {
                                "type": "password",
                                "name": "password6",
                                "placeholder": "请输入密码",
                                "labelClassName": "w-auto p-r-none",
                                "mode": "inline"
                            }
                        ]
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "group",
                        "label": "邮箱",
                        "description": "bla bla",
                        "direction": "vertical",
                        "controls": [
                            {
                                "type": "email",
                                "name": "email9",
                                "mode": "normal",
                                "placeholder": "请输入邮箱地址",
                                "inline": true,
                                "description": "Bla blamfejkf fdjk"
                            },
                            {
                                "type": "password",
                                "name": "password9",
                                "mode": "normal",
                                "placeholder": "请输入密码",
                                "labelClassName": "w-auto p-r-none"
                            }
                        ]
                    },
                    {
                        "type": "divider"
                    },
                    {
                        "type": "checkbox",
                        "name": "rememberMe",
                        "label": "记住我"
                    },
                    {
                        "type": "submit",
                        "btnClassName": "btn-default",
                        "label": "Submit"
                    }
                ]
            },
            {
                "type": "form",
                "api": "https://houtai.baidu.com/api/mock2/form/saveForm?waitSeconds=2",
                "title": "Inline form  用数组包起来还能控制一行显示多个",
                "mode": "inline",
                "submitText": null,
                "autoFocus": false,
                "controls": [
                    [
                        {
                            "type": "email",
                            "name": "email",
                            "placeholder": "Enter Email",
                            "label": "邮箱",
                            "size": "full"
                        },
                        {
                            "type": "password",
                            "name": "password",
                            "placeholder": "Password",
                            "size": "full"
                        }
                    ],
                    {
                        "type": "divider"
                    },
                    [
                        {
                            "type": "email",
                            "name": "email",
                            "placeholder": "Enter Email",
                            "label": "邮箱",
                            "size": "full"
                        },
                        {
                            "type": "checkbox",
                            "name": "rememberMe",
                            "label": "记住我",
                            "size": "full"
                        },
                        {
                            "type": "button-toolbar",
                            "buttons": [
                                {
                                    "type": "submit",
                                    "label": "登录"
                                },
                                {
                                    "type": "button",
                                    "label": "导出",
                                    "url": "http://www.baidu.com/",
                                    "level": "success"
                                }
                            ]
                        }
                    ]
                ]
            }
        ]
    }
- name: "模板商城"
  identify: "/tools/tpl_store"
  source: |
    {
        "$schema": "https://houtai.baidu.com/v2/schemas/page.json",
        "type": "page",
        "title": "模板商城",
        "body": [
            {
                "type": "plain",
                "text": "正在努力开发中..."
            }
        ]
    }